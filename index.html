<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤§æ¨¹å¥åº·è³¼ç‰©ç¶² - Pharma.Duck æ™ºæ…§å°è³¼ç¤ºç¯„</title>
    <style>
        /* åŸºç¤è¨­å®š */
        :root {
            --greattree-green: #009944;
            --greattree-orange: #F39800;
            --bg-gray: #f5f5f5;
        }
        body { font-family: "Microsoft JhengHei", sans-serif; margin: 0; padding: 0; background-color: var(--bg-gray); }
        
        /* æ¨¡æ“¬å°èˆªåˆ— (Logo ä¿®æ”¹è™•) */
        header { background: white; padding: 10px 0; border-bottom: 3px solid var(--greattree-green); box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .nav-container { max-width: 1200px; margin: 0 auto; display: flex; align-items: center; justify-content: space-between; padding: 0 20px; }
        
        /* ä¿®æ”¹ï¼šLogo å€å¡Šç¾åœ¨åŒ…å«åœ–ç‰‡ */
        .logo { display: flex; align-items: center; }
        .logo img { height: 50px; width: auto; } /* è¨­å®š Logo é«˜åº¦ */

        .search-bar { flex-grow: 1; margin: 0 40px; display: flex; }
        .search-bar input { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px 0 0 4px; outline: none;}
        .search-bar button { padding: 10px 20px; background: var(--greattree-green); color: white; border: none; border-radius: 0 4px 4px 0; cursor: pointer; }
        .nav-links { font-size: 14px; color: #666; }

        /* å•†å“åˆ—è¡¨æ¨¡æ“¬ */
        .main-content { max-width: 1200px; margin: 20px auto; padding: 0 20px; }
        .banner { width: 100%; height: 300px; background: linear-gradient(to right, #e0e0e0, #f0f0f0); border-radius: 8px; margin-bottom: 20px; display: flex; justify-content: center; align-items: center; color: #888; font-size: 24px; font-weight: bold;}
        .product-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; }
        .product-card { background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); transition: 0.3s; position: relative; border: 2px solid transparent;}
        .product-card:hover { transform: translateY(-5px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .tag-rec { position: absolute; top: -2px; right: -2px; background: var(--greattree-orange); color: white; padding: 4px 12px; font-size: 12px; border-radius: 0 8px 0 8px; display: none; z-index: 2; font-weight: bold;}
        .p-img { height: 150px; background: #eee; margin-bottom: 10px; border-radius: 4px; display: flex; align-items: center; justify-content: center; color: #aaa; }
        .p-name { font-weight: bold; margin-bottom: 5px; height: 40px; overflow: hidden; font-size: 15px;}
        .p-price { color: #d0021b; font-weight: bold; font-size: 18px; }

        /* ä¿®æ”¹ï¼šå³ä¸‹è§’å¤§å‹å°è³¼é´¨é´¨ (å–ä»£åŸæœ¬çš„åœ“å½¢æŒ‰éˆ•) */
        .duck-assistant-large {
            position: fixed;
            bottom: 0px; /* è²¼åº•ç«™ç«‹ */
            right: 20px;
            width: 220px; /* è¨­å®šå¯¬åº¦ï¼Œè®“å®ƒçœ‹èµ·ä¾†å¤ å¤§ */
            height: auto;
            cursor: pointer;
            z-index: 1000;
            transition: transform 0.3s ease;
        }
        /* æ»‘é¼ ç§»éå»æ™‚ç¨å¾®æµ®èµ· */
        .duck-assistant-large:hover {
            transform: translateY(-10px);
        }
        .duck-assistant-large img {
            width: 100%;
            height: auto;
            display: block;
            /* åŠ ä¸Šé™°å½±å¢åŠ ç«‹é«”æ„Ÿ */
            filter: drop-shadow(2px 5px 15px rgba(0,0,0,0.3));
        }

        /* Pharma.Duck å°è©±è¦–çª— */
        .duck-chat-window {
            position: fixed;
            bottom: 200px; /* èª¿æ•´è¦–çª—ä½ç½®ï¼Œé¿å…æ“‹ä½å¤§é´¨é´¨ */
            right: 50px;
            width: 350px;
            height: 500px;
            background: white;
            border-radius: 16px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            display: none; /* é è¨­éš±è— */
            flex-direction: column;
            z-index: 1001; /* æ¯”é´¨å­æ›´é«˜ä¸€å±¤ */
            overflow: hidden;
            border: 1px solid #ddd;
        }
        
        /* èŠå¤©è¦–çª—é ­éƒ¨ */
        .chat-header {
            background: var(--greattree-green); color: white; padding: 15px; display: flex; align-items: center;
        }
        .chat-header-img { width: 40px; height: 40px; background: white; border-radius: 50%; margin-right: 10px; overflow: hidden; border: 2px solid var(--greattree-orange);}
        .chat-header-img img { width: 100%; height: 100%; object-fit: cover; }

        /* èŠå¤©å…§å®¹å€ */
        .chat-messages {
            flex-grow: 1;
            padding: 15px;
            overflow-y: auto;
            background: #fafafa;
        }
        .msg { margin-bottom: 12px; max-width: 85%; line-height: 1.4; font-size: 14px; }
        .msg-duck { align-self: flex-start; }
        .msg-duck .bubble { background: white; padding: 12px 16px; border-radius: 18px 18px 18px 4px; border: 1px solid #eee; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
        .msg-user { align-self: flex-end; margin-left: auto; text-align: right; }
        .msg-user .bubble { background: var(--greattree-green); color: white; padding: 10px 14px; border-radius: 18px 18px 4px 18px; display: inline-block; }
        
        /* æ¨è–¦å•†å“å¡ç‰‡ (åœ¨å°è©±ä¸­) */
        .rec-card {
            background: white;
            border: 2px solid var(--greattree-orange);
            border-radius: 8px;
            padding: 10px;
            margin-top: 10px;
            display: flex;
            gap: 10px;
            cursor: pointer;
            transition: 0.2s;
        }
        .rec-card:hover { background: #fffbe6; }
        .rec-card img { width: 60px; height: 60px; background: #ddd; object-fit: cover; border-radius: 4px;}
        .rec-info { flex-grow: 1; }
        .rec-title { font-weight: bold; font-size: 14px; color: var(--greattree-green); }
        .rec-reason { font-size: 12px; color: #666; margin-top: 4px; line-height: 1.3; }
        .rec-action { margin-top: 8px; font-size: 12px; color: var(--greattree-orange); font-weight: bold; text-align: right;}

        /* è¼¸å…¥å€ */
        .chat-input-area {
            padding: 10px;
            background: white;
            border-top: 1px solid #eee;
            display: flex;
            gap: 10px;
        }
        .chat-input-area input {
            flex-grow: 1;
            border: 1px solid #ddd;
            border-radius: 20px;
            padding: 10px 15px;
            outline: none;
        }
        .chat-input-area button {
            background: var(--greattree-orange);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .typing { font-size: 12px; color: #888; margin-left: 15px; margin-bottom: 10px; display: none; font-style: italic;}
    </style>
</head>
<body>

<header>
    <div class="nav-container">
        <div class="logo">
            <img src="https://www.greattree.com.tw/images/logo.png" alt="å¤§æ¨¹è—¥å±€ Logo">
        </div>
        <div class="search-bar">
            <input type="text" placeholder="æœå°‹å•†å“ã€å“ç‰Œæˆ–è¼¸å…¥ç—‡ç‹€ (Demoç‰ˆ)...">
            <button>æœå°‹</button>
        </div>
        <div class="nav-links">æœƒå“¡ç™»å…¥ | è³¼ç‰©è»Š(0) | é–€å¸‚æŸ¥è©¢</div>
    </div>
</header>

<div class="main-content">
    <div class="banner">ğŸ‰ Pharma.Duck å°é´¨è—¥å¸« å…¨æ–°ä¸Šç·šï¼</div>
    <h2 style="color: #333;">ç†±é–€ä¿å¥å“</h2>
    <div class="product-grid" id="productGrid">
        </div>
</div>

<div class="duck-assistant-large" onclick="toggleChat()">
    <img src="my_duck.png" alt="Ph.D é´¨é´¨å°è³¼">
</div>

<div class="duck-chat-window" id="chatWindow">
    <div class="chat-header">
        <div class="chat-header-img">
            <img src="my_duck.png" alt="é´¨">
        </div>
        <div style="font-weight: bold;">Ph.D é´¨å­è—¥å¸« (ç·šä¸Šè«®è©¢)</div>
        <div style="margin-left: auto; cursor: pointer; font-size: 20px;" onclick="toggleChat()">âœ•</div>
    </div>

    <div class="chat-messages" id="chatMsg">
        <div class="msg msg-duck">
            <div class="bubble">æ‚¨å¥½ï¼æˆ‘æ˜¯æ‚¨çš„å°ˆå±¬å¥åº·é¡§å• Ph.D é´¨é´¨ã€‚ğŸ¦†<br>ä»Šå¤©æƒ³æ‰¾ä»€éº¼æ–¹é¢çš„ä¿å¥å“å‘¢ï¼Ÿæˆ‘å¯ä»¥å¹«æ‚¨æ¯”è¼ƒæˆåˆ†å–”ï¼âœ¨</div>
        </div>
    </div>
    
    <div class="typing" id="typingIndicator">é´¨é´¨æ­£åœ¨æ€è€ƒä¸­... ğŸ¤”</div>

    <div class="chat-input-area">
        <input type="text" id="userInput" placeholder="è¼¸å…¥ç—‡ç‹€ï¼Œä¾‹ï¼šå¥¶å¥¶è†è“‹ç—›..." onkeypress="handleKeyPress(event)">
        <button onclick="sendMessage()">â¤</button>
    </div>
</div>

<script>
    // æ¨¡æ“¬å•†å“è³‡æ–™åº«
    const products = [
        { id: 1, name: "å¤§æ¨¹ç‰¹é¸ æ·±æµ·é­šæ²¹ 1000mg", price: 1200, tag: "å¿ƒè¡€ç®¡/é—œç¯€", imgColor: "#a3d1ff" },
        { id: 2, name: "æŒºç«‹ é—œéµè¿·ä½ éŒ  UC-II", price: 1580, tag: "é—œç¯€ä¿é¤Š", imgColor: "#ffcdd2" },
        { id: 3, name: "æ¡‚æ ¼ å®Œè†³ç‡Ÿé¤Šç´  (åŸå‘³)", price: 650, tag: "æˆäººç‡Ÿé¤Š", imgColor: "#e1bee7" },
        { id: 4, name: "å–„å­˜ éŠ€å¯¶ç¶œåˆç¶­ä»–å‘½", price: 880, tag: "é•·è¼©ç¶­ä»–å‘½", imgColor: "#fff9c4" },
        { id: 5, name: "èŠèƒç¾ è‘‰é»ƒç´ è† å›Š", price: 900, tag: "è¦–åŠ›ä¿å¥", imgColor: "#c8e6c9" },
        { id: 6, name: "åˆåˆ©ä»–å‘½ Ex Plus", price: 1800, tag: "Bç¾¤/ç— ç—›", imgColor: "#ffecb3" },
        { id: 7, name: "å¤§æ¨¹ è‘¡è„ç³–èƒºé£²", price: 600, tag: "é—œç¯€ä¿é¤Š", imgColor: "#b2dfdb" },
        { id: 8, name: "æ™®æ‹¿ç–¼ æ­¢ç—›è—¥ (ä¹™é†¯èƒºé…š)", price: 150, tag: "OTC è—¥å“", imgColor: "#f0f0f0" }
    ];

    // åˆå§‹åŒ–å•†å“åˆ—è¡¨
    const grid = document.getElementById('productGrid');
    products.forEach(p => {
        grid.innerHTML += `
            <div class="product-card" id="pid-${p.id}">
                <div class="tag-rec">é´¨é´¨æ¨è–¦ âœ¨</div>
                <div class="p-img" style="background:${p.imgColor}">å•†å“åœ–</div>
                <div class="p-name">${p.name}</div>
                <div class="p-price">$${p.price}</div>
            </div>
        `;
    });

    // èŠå¤©å®¤é–‹é—œ
    function toggleChat() {
        const win = document.getElementById('chatWindow');
        win.style.display = win.style.display === 'flex' ? 'none' : 'flex';
        // æ‰“é–‹æ™‚è‡ªå‹•èšç„¦è¼¸å…¥æ¡†
        if (win.style.display === 'flex') {
            document.getElementById('userInput').focus();
        }
    }

    // è™•ç†æŒ‰éµ
    function handleKeyPress(e) {
        if (e.key === 'Enter') sendMessage();
    }

    // ç™¼é€è¨Šæ¯é‚è¼¯ (æ¨¡æ“¬å¾Œç«¯)
    function sendMessage() {
        const input = document.getElementById('userInput');
        const text = input.value.trim();
        if (!text) return;

        // 1. é¡¯ç¤ºä½¿ç”¨è€…è¨Šæ¯
        addMessage(text, 'user');
        input.value = '';

        // 2. æ¨¡æ“¬ RAG æ€è€ƒ
        showTyping(true);

        setTimeout(() => {
            // 3. ç°¡å–®çš„é—œéµå­—è§¸ç™¼é‚è¼¯ (æ¨¡æ“¬ AI å›æ‡‰)
            let response = "";
            let recProductId = null;
            let recReasonText = "";

            if (text.includes("é—œç¯€") || text.includes("è†è“‹") || text.includes("å©†å©†") || text.includes("ç—›") || text.includes("é˜¿å¬¤")) {
                response = "è½èµ·ä¾†é•·è¼©å¯èƒ½æœ‰é€€åŒ–æ€§é—œç¯€ç‚çš„å›°æ“¾ã€‚é‡å°é€™å€‹ç‹€æ³ï¼Œæˆ‘å»ºè­°é¸æ“‡å«æœ‰ **UC-II** æˆ– **é«˜æ¿ƒåº¦é­šæ²¹** çš„ç”¢å“ï¼Œèƒ½å¹«åŠ©æŠ—ç™¼ç‚ä¸¦æ½¤æ»‘é—œç¯€ã€‚ğŸ¦†";
                recProductId = 2; // æ¨è–¦ UC-II
                recReasonText = "æ ¹æ“šæ‚¨çš„æè¿°ï¼Œé€™æ¬¾å«æœ‰è¶³é‡ UC-IIï¼Œæ˜¯è¨±å¤šè—¥å¸«æ¨è–¦çš„é¸æ“‡ï¼";
            } else if (text.includes("ç‡Ÿé¤Š") || text.includes("é•·è¼©") || text.includes("é«”åŠ›") || text.includes("æ¡‚æ ¼")) {
                response = "å¦‚æœæ˜¯è¦å¹«å®¶ä¸­é•·è¼©è£œå……é«”åŠ›ï¼Œç‡Ÿé¤Šå‡è¡¡éå¸¸å¥½å¸æ”¶ï¼Œå¾ˆé©åˆé£Ÿæ…¾ä¸ä½³çš„é•·è¼©å–”ï¼";
                recProductId = 3;
                recReasonText = "å¤§æ¨¹ç†±éŠ·æ¬¾ï¼Œç‡Ÿé¤Šå‡è¡¡ï¼Œè©•åƒ¹å¾ˆå¥½å–”ï¼";
            } else if (text.includes("çœ¼ç›") || text.includes("è‘‰é»ƒç´ ") || text.includes("é…¸")) {
                response = "ç¾ä»£äººç”¨çœ¼éåº¦ï¼Œ**è‘‰é»ƒç´ **æ­é…**èŠ±é’ç´ **æ•ˆæœæ›´å¥½å–”ï¼å»ºè­°é£¯å¾Œé£Ÿç”¨å¸æ”¶è¼ƒä½³ã€‚";
                recProductId = 5;
                recReasonText = "é€™æ¬¾æ˜¯æ¸¸é›¢å‹è‘‰é»ƒç´ ï¼Œå¸æ”¶ç‡è¼ƒå¥½ã€‚";
            } else {
                response = "é€™å€‹å•é¡Œæ¯”è¼ƒå°ˆæ¥­ ğŸ¤”ï¼Œå»ºè­°æ‚¨å¯ä»¥åˆ°å¤§æ¨¹å¯¦é«”é–€å¸‚è«®è©¢è—¥å¸«ï¼Œæˆ–æ˜¯æˆ‘å€‘å¯ä»¥å…ˆå¾ç†±é–€çš„ç¶œåˆç¶­ä»–å‘½é–‹å§‹çœ‹èµ·ï¼Ÿ";
            }

            showTyping(false);
            addMessage(response, 'duck');

            // 4. å¦‚æœæœ‰æ¨è–¦å•†å“ï¼Œé¡¯ç¤ºæ¨è–¦å¡ä¸¦é«˜äº®èƒŒå¾Œçš„å•†å“
            if (recProductId) {
                const p = products.find(i => i.id === recProductId);
                addRecCard(p, recReasonText);
                
                // ç¶²é é€£å‹•æ•ˆæœ (Highlight)
                document.querySelectorAll('.product-card').forEach(c => {
                    c.style.border = "2px solid transparent";
                    c.querySelector('.tag-rec').style.display = "none";
                });
                const targetCard = document.getElementById(`pid-${p.id}`);
                targetCard.style.border = "2px solid #F39800";
                targetCard.querySelector('.tag-rec').style.display = "block";
                // å¹³æ»‘æ²å‹•åˆ°å•†å“ä½ç½®
                setTimeout(() => {
                     targetCard.scrollIntoView({behavior: "smooth", block: "center"});
                }, 500);
            }

        }, 1200); // æ¨¡æ“¬å»¶é²
    }

    function addMessage(text, sender) {
        const chatBox = document.getElementById('chatMsg');
        chatBox.innerHTML += `
            <div class="msg msg-${sender}">
                <div class="bubble">${text}</div>
            </div>
        `;
        chatBox.scrollTop = chatBox.scrollHeight;
    }

    function addRecCard(product, reason) {
        const chatBox = document.getElementById('chatMsg');
        chatBox.innerHTML += `
            <div class="msg msg-duck">
                <div class="rec-card" onclick="alert('ï¼ˆæ¨¡æ“¬ï¼‰å°å¼•è‡³å•†å“é é¢: ${product.name}')">
                    <img src="" style="background:${product.imgColor}" alt="${product.name}">
                    <div class="rec-info">
                        <div class="rec-title">${product.name}</div>
                        <div class="rec-reason">${reason}</div>
                        <div class="rec-action">é»æ“ŠæŸ¥çœ‹è©³æƒ… ></div>
                    </div>
                </div>
            </div>
        `;
        chatBox.scrollTop = chatBox.scrollHeight;
    }

    function showTyping(show) {
        document.getElementById('typingIndicator').style.display = show ? 'block' : 'none';
    }
</script>

</body>
</html>
